# 分析表的逻辑介绍 

## 数据获取

分析表的分析原理, 是基于标识 [每日全文汇总公式] 所在的列的单元格数据, 其逻辑为根据公式

=TEXTJOIN(
    CHAR(10), 
    TRUE, 
    INDIRECT("写入!A" & ROW()), 
    INDIRECT("写入!U" & ROW()-1 & ":Y" & ROW()-1), 
    INDIRECT("写入!B" & ROW() & ":T" & ROW())
)

得到汇总数据, 其中 A 用于获取当前日期, U-Y (均减壹) 为第二日的 0:00-4:59, B-T 为当日的 5:00-23:59 

### 公式优势

这个公式是基于当前分析表的 ROW() 结果值为索引, 跨 sheet 引用另一个表来实现的。本公式设计为在每个单元格都完全一致, 优点:
 
1. 方便从任意单元格上拉或下拉增加分析行。
2. 不受一般公式「在中间行位置新增行, 会改变公式内容」的影响, 有着高鲁棒性。
3. 做到了完全映射, 不会因为插入或删减行导致丢失映射。

## 分析原理

1. 本地通过飞书api获取 [每日全文汇总公式] 所在的列的单元格数据
2. 然后用 Python 在本地分析这些数据
3. 分析完成后, 将数据按形如 [这样的不同标识] 写回标识所在的列